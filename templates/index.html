<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PDF Compressor - Reduce File Size</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #f0f4f8 0%, #e6f3fa 100%);
      min-height: 100vh; padding: 3rem 1rem;
    }
    .container { max-width: 48rem; margin: 0 auto; }
    .header { text-align: center; margin-bottom: 2rem; }
    .icon-wrapper {
      display:inline-flex; align-items:center; justify-content:center;
      width:4rem; height:4rem; border-radius:1rem;
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
      margin-bottom:1rem; box-shadow:0 4px 12px rgba(14,165,233,.25);
    }
    .icon-wrapper svg { width:2rem; height:2rem; stroke:white; fill:none; stroke-width:2; }
    h1 {
      font-size:2.25rem; font-weight:700;
      background: linear-gradient(135deg, #0ea5e9 0%, #0891b2 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      margin-bottom:.5rem;
    }
    .subtitle { color:#64748b; font-size:1rem; }
    .card { background:#fff; border-radius:.75rem; padding:1.5rem; box-shadow:0 2px 16px rgba(0,0,0,.08); }
    .form-group { margin-bottom:1.5rem; }
    label { display:block; font-size:.875rem; font-weight:500; margin-bottom:.5rem; color:#1e293b; }
    input[type="file"], input[type="number"] {
      width:100%; padding:.625rem; border:1px solid #e2e8f0; border-radius:.5rem; font-size:.875rem; transition:.2s;
    }
    input[type="file"]:hover, input[type="number"]:hover { border-color:#cbd5e1; }
    input[type="file"]:focus, input[type="number"]:focus {
      outline:none; border-color:#0ea5e9; box-shadow:0 0 0 3px rgba(14,165,233,.1);
    }
    .file-info { margin-top:.5rem; font-size:.875rem; color:#64748b; }
    .grid { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    @media (max-width:768px) { .grid { grid-template-columns:1fr; } }
    .hint { font-size:.75rem; color:#64748b; margin-top:.25rem; }
    input[type="range"] { width:100%; height:.5rem; border-radius:.25rem; background:#e2e8f0; outline:none; margin-top:.5rem; -webkit-appearance:none; }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance:none; appearance:none; width:1.25rem; height:1.25rem; border-radius:50%;
      background:#0ea5e9; cursor:pointer; box-shadow:0 2px 8px rgba(14,165,233,.4);
    }
    input[type="range"]::-moz-range-thumb {
      width:1.25rem; height:1.25rem; border-radius:50%; background:#0ea5e9; cursor:pointer; border:none;
      box-shadow:0 2px 8px rgba(14,165,233,.4);
    }
    .checkbox-group { display:flex; align-items:center; gap:.5rem; }
    input[type="checkbox"] { width:1.25rem; height:1.25rem; cursor:pointer; accent-color:#0ea5e9; }
    .checkbox-group label { margin:0; font-weight:400; cursor:pointer; }
    button {
      width:100%; padding:.75rem 1rem; font-size:1rem; font-weight:500; color:#fff;
      background: linear-gradient(135deg, #0ea5e9 0%, #06b6d4 100%);
      border:none; border-radius:.5rem; cursor:pointer; transition:.2s;
      box-shadow:0 4px 12px rgba(14,165,233,.25);
    }
    button:hover:not(:disabled) { transform:translateY(-1px); box-shadow:0 6px 16px rgba(14,165,233,.3); }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .results {
      margin-top:1.5rem; padding:1rem;
      background: linear-gradient(135deg, #e0f2fe 0%, #cffafe 100%);
      border-radius:.5rem; border:1px solid #bae6fd;
    }
    .results-row { display:flex; justify-content:space-between; margin-bottom:.75rem; font-size:.875rem; }
    .results-row:last-child { margin-bottom:0; padding-top:.75rem; border-top:1px solid #bae6fd; font-size:1rem; }
    .results-label { color:#64748b; }
    .results-value { font-weight:500; color:#0e7490; }
    .results-saved { font-size:1.5rem; font-weight:700; color:#0e7490; }
    .download-btn { margin-top:1rem; display:flex; align-items:center; justify-content:center; gap:.5rem; }
    .flash { background:#fef3c7; color:#92400e; padding:.75rem; border-radius:.5rem; margin-bottom:1rem; border:1px solid #fde68a; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="icon-wrapper">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
          <line x1="10" y1="9" x2="8" y2="9"/>
        </svg>
      </div>
      <h1>PDF Compressor</h1>
      <p class="subtitle">Image downsampling compression: Powered by Elvis Chiwota</p>
    </div>

    <div class="card">
      {% with messages = get_flashed_messages() %}
        {% if messages %}
          {% for m in messages %}
            <div class="flash">{{ m }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form action="{{ url_for('compress') }}" method="post" enctype="multipart/form-data">
        <div class="form-group">
          <label for="pdf-upload">Choose PDF</label>
          <input type="file" id="pdf-upload" name="pdf" accept="application/pdf" required>
        </div>

        <div class="grid">
          <div class="form-group">
            <label for="max-side">Max image side: <span id="max-side-value">{{ form.max_side|default(600) }}</span>px</label>
            <input
              type="number"
              id="max-side"
              name="max_side"
              min="600" max="4000" step="50"
              value="{{ form.max_side|default(600) }}"
            />
            <div class="hint">Large scans: 1500–2000 px</div>
          </div>

          <div class="form-group">
            <label for="quality">JPEG quality: <span id="quality-value">{{ form.quality|default(40) }}</span></label>
            <input
              type="range"
              id="quality"
              name="quality"
              min="30" max="90" step="1"
              value="{{ form.quality|default(40) }}"
            />
            <div class="hint">50–70 is good range</div>
          </div>
        </div>

        <div class="form-group">
          <div class="checkbox-group">
            <input
              type="checkbox"
              id="grayscale"
              name="grayscale"
              {% if form.grayscale %}checked{% endif %}
            />
            <label for="grayscale">Convert to grayscale</label>
          </div>
        </div>

        <button type="submit">Compress PDF</button>
      </form>

      {% if result %}
      <div class="results">
        <div class="results-row">
          <span class="results-label">Original:</span>
          <span class="results-value">{{ result.orig_name }} — {{ result.orig_size }} MB</span>
        </div>
        <div class="results-row">
          <span class="results-label">Compressed:</span>
          <span class="results-value">{{ result.out_name }} — {{ result.out_size }} MB</span>
        </div>
        <div class="results-row">
          <span class="results-label">Saved:</span>
          <span class="results-saved">{{ result.saved }}%</span>
        </div>
        <a href="{{ url_for('download', filename=result.out_file) }}" style="text-decoration:none;">
          <button type="button" class="download-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="7 10 12 15 17 10"/>
              <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Download Compressed PDF
          </button>
        </a>
      </div>
      {% endif %}
    </div>
  </div>

  <script>
    // Sync live display with inputs (initial + on change)
    const maxSideInput = document.getElementById('max-side');
    const maxSideValue = document.getElementById('max-side-value');
    const qualityInput = document.getElementById('quality');
    const qualityValue = document.getElementById('quality-value');

    function syncDisplays() {
      if (maxSideInput && maxSideValue) maxSideValue.textContent = maxSideInput.value;
      if (qualityInput && qualityValue) qualityValue.textContent = qualityInput.value;
    }
    syncDisplays();

    maxSideInput?.addEventListener('input', () => { maxSideValue.textContent = maxSideInput.value; });
    qualityInput?.addEventListener('input', () => { qualityValue.textContent = qualityInput.value; });

    // File info
    const fileInput = document.getElementById('pdf-upload');
    fileInput?.addEventListener('change', (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      document.querySelector('.file-info')?.remove();
      const info = document.createElement('div');
      info.className = 'file-info';
      info.textContent = `${file.name} (${(file.size / (1024 * 1024)).toFixed(2)} MB)`;
      fileInput.parentElement.appendChild(info);
    });
  </script>
</body>
</html>
